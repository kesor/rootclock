#!/usr/bin/env bash
set -euo pipefail

c_files=(rootclock.c config.def.h)
nix_files=(flake.nix default.nix nix/default.nix nix/package.nix)

if ! command -v clang-format >/dev/null 2>&1; then
  printf 'clang-format not found in PATH. Please install it or adjust the dev shell.\n' >&2
  exit 1
fi

if ! command -v nixfmt >/dev/null 2>&1; then
  printf 'nixfmt not found in PATH. Please install it or adjust the dev shell.\n' >&2
  exit 1
fi

changed=0
for file in "${c_files[@]}"; do
  if [ -f "$file" ]; then
    clang-format -i "$file"
    git add "$file"
    changed=1
  fi
done

for file in "${nix_files[@]}"; do
  if [ -f "$file" ]; then
    nixfmt "$file"
    git add "$file"
    changed=1
  fi
done

if [ "$changed" -eq 1 ]; then
  printf 'Formatting hooks applied. Changes staged.\n'
fi
